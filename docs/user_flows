# User Flows

## 1. First-Time User Journey (Post-Waitlist Launch)

### Step 1: Landing Page (www.teamshots.vip)
```
User visits site
â†“
Auto-detect browser language (EN or ES)
- If browser = Spanish â†’ Show Spanish
- Otherwise â†’ Show English
â†“
See value prop: "Professional team photos in 60 seconds"
â†“
Language switcher in header (if user wants to change)
â†“
CTA: "Get Started" or "See How It Works"
```

### Step 2: Sign Up (redirects to app.teamshots.vip)
```
Click "Get Started"
â†"
Redirect to app.teamshots.vip/auth/signin
â†"
Sign up with email/password
- Choose account type (Individual or Team)
- Enter email
- Create password
- Confirm password
â†"
OTP sent to email â†' user enters OTP
â†"
After verification:
- First name
- If Team selected:
  - After OTP, first dashboard entry triggers team setup flow (name, website, domain verification)
  - If domain mismatch: request team email → OTP verification
  - **CRITICAL**: Team credits (30) are assigned during signup but only become visible after team setup completion
  - **Issue**: If user doesn't complete team setup flow, credits show as 0 in dashboard despite being assigned to team
â†"
Language preference auto-set from current selection
â†"
Redirect to onboarding
â†"
Background: If team, scrape team page â†' extract names/photos
```

### Team Invite Flow
```
Admin creates team context (background, logo, style)
â†"
Admin invites team member with email + credit allocation
â†"
System sends email with 24hr invite link
â†"
Team member clicks link (no signup required)
â†"
Team member enters first/last name
â†"
System creates Person record + CreditTransaction (allocates credits)
â†"
Team member can immediately upload selfie and generate photos
â†"
If team member signs up later, User account links to existing Person
```

**Note:** OAuth (Google, GitHub) will be added post-MVP for faster authentication.

### Step 3: Onboarding
```
Welcome screen
- Brief explanation (3 slides or 30s video)
- "Try with sample photo" option

â†“
Guided first generation
- Tooltip: "Upload any photo"
- Tooltip: "Choose a style"
- Tooltip: "This will use 10 credits"

â†“
First successful generation
â†“
Celebration moment: "Great! Your first professional photo"
â†“
"Add payment method to continue"
```

### Step 4: Payment Setup
```
Add payment method (Stripe)
â†“
Choose plan or buy credits
â†“
Redirect to dashboard
```

## 2. Core Generation Flow

### Happy Path
```
Dashboard
â†"
"Generate New Photo" button
â†"
Upload photo
- Drag-drop or file picker
- Show preview
- Validate (face detection)
â†"
GENERATION CONTEXT (auto-selected from account type)
- Individual accounts: personal credits, full control, private
- Team accounts: team credits, preset styles, admin visible
â†"
Customize (based on selection)
- Personal: Select style preset, background, logo options
- Team: Use team context (background, logo, style preset)
- Show cost: "Uses 10 credits (1 generation)"
â†"
Click "Generate"
â†"
Processing screen (up to 60s)
- Progress bar
- "Generating your professional photos..."
â†"
Review variations (3-4 images)
- Side-by-side view
- Click for large preview
â†"
Actions:
- "Download" â†' Get high-res file
- "Regenerate" â†' Adjust settings, uses 4 more credits
- "Cancel" â†' Return to dashboard
```

### Error States
```
Insufficient credits
â†“
"You need 10 credits for this generation."
- Show current balance
- "Buy more credits" or "Subscribe" button
â†“
Redirect to purchase page

OR

Generation failed
â†“
"Something went wrong. Your 10 credits have been refunded." (translated)
â†“
"Try again" button

OR

Upload validation failed
â†“
"Please upload a clear photo with a visible face" (translated)
â†“
Return to upload
```

## 3. Login Flow

```
Email + password OR magic link option
â†"
If magic link: Send link â†' click â†' auto-login
â†"
Redirect to dashboard
```

## 4a. Team Member Invite & Upload Flow (Token-Based)

```
Admin sends invite link with 24hr token + credit allocation
â†'
Team member clicks link (no signup required)
â†'
Token validation (if expired: send new token to email)
â†'
Upload selfie
- Face validation
- Image quality check
â†'
GENERATION CONTEXT (auto-selected from account type)
- Individual accounts: personal credits, full control, private
- Team accounts: team credits, preset styles, admin visible
â†'
Processing with selected context
- Personal: Full style control
- Team: Background, logo, clothing, expression (set by admin)
â†'
APPROVAL SCREEN
"Review your generated photo"
- Show generated photo
- Show logo placement variations (if team)
- Display remaining credits (both individual & team)
â†'
Actions:
- "Approve & Save" â†' Photo saved to database
- "Regenerate" â†' Costs 1 credit from selected source
- "Sign up for personal use" â†' CTA to create account
â†'
If rejected: Original selfie kept, generated photo deleted
```

## 4b. Team Admin Setup & Management Flow

```
Admin logs in â†' Dashboard
â†'
"Create Team Photo Project" CTA
â†'
STEP 1: Context Setup (Required before inviting)
- Upload custom background image OR select preset
- Upload logo (system auto-removes background)
- Set clothing style: Formal / Casual / Swag
- Set expression: Happy / Serious / Funny / Powerpose
- Preview combinations
â†'
STEP 2: Team Invitations
- Import from scraped team data OR manually enter emails
- Set credit allocation per member (default: 5 credits)
- Send invites with 24hr tokens
â†'
ADMIN DASHBOARD
- View team progress (uploaded/pending/approved)
- Adjust individual credits
- View approved photos only
- "Regenerate All with New Context" (uses team credit pool)
- Create additional contexts for different styles
```

## 4. Team Photo Workflow

See ## 4a and ## 4b for detailed team workflows.

### Token-Based Team Invites
- 24hr expiration with automatic renewal
- No signup required for team members
- CTAs to sign up for personal use during/after generation
- Same uploaded photo can be used for both personal and team generations

### Generation Type Selection
- **Personal Use**: Individual credits, full style control, private photos
- **Team Use**: Team credits, preset styles, admin visible
- Clear credit cost display (10 credits per generation)
- Both credit types shown in sidebar and decision screen

## 5. Returning User Flow

```
Login
â†"
Dashboard
- Credit balance: "87 credits (21 generations)"
- "Generate New Photo" CTA
- Gallery of previous generations
- Subscription status (if subscribed)
â†“
Generate new photo (same as core flow)
OR
View history
OR
Manage account/subscription
OR
Buy more credits
```

## 4. Credit Purchase Flows

### Try Once Purchase
```
User needs to try the service
â†"
Click "Try Once" (see Business Model for pricing)
â†"
Stripe checkout
â†"
Payment confirmation
â†"
Credits added to account
â†"
Email receipt
â†"
Redirect to generation flow
```

### Subscription Purchase
```
User wants ongoing access
â†"
View pricing page (see Business Model for detailed pricing tiers)
â†"
Select tier and period (monthly/annual)
â†"
Stripe checkout
â†"
Subscription confirmed
â†"
Credits added monthly
â†"
Email confirmation
â†"
Dashboard
```

### Top-up Purchase
```
User runs low on credits
â†"
"Buy More Credits" or prompted during generation
â†"
Select amount (see Business Model for pricing tiers and minimums)
â†"
Stripe checkout
â†"
Credits added immediately
â†"
Return to generation flow or dashboard
```

## 5. Subscription Management Flow

```
Dashboard â†’ "Manage Subscription"
â†“
View current plan
- Credits included
- Next billing date
- Usage this month
â†“
Actions:
- Upgrade plan
- Downgrade plan
- Cancel subscription
- Update payment method
â†“
Confirmation
â†“
Email notification
```

## 6. Admin Flows (If Needed)

### User Management
```
Admin dashboard
â†“
View all users
- Search/filter
- See credit balance, usage
â†“
Actions:
- Grant bonus credits
- View user's generations
- Suspend account (if needed)
```

## Key Screens Required

**Note:** All screens must support EN/ES with next-intl

1. **Landing Page** - Marketing, value prop
2. **Sign Up/Login** - Auth.js integration (email/password + OAuth)
3. **Onboarding** - Welcome flow
4. **Dashboard** - Credit balance, CTA, history
5. **Upload** - Photo upload interface
6. **Customize** - Style/background selection
7. **Processing** - Loading state
8. **Review** - View variations
9. **Payment** - Add payment method
10. **Purchase** - Buy credits
11. **Settings** - Account, billing, subscription, language preference
12. **History** - Past generations

## Navigation

### Marketing Site (www.teamshots.vip)
```
Header: Logo | Features | Pricing | Language (EN/ES) | Login | Sign Up
```

### Application (app.teamshots.vip - logged in only)
```
Header: Logo | Dashboard | History | 87 credits (21 gen) | Language (EN/ES) | Profile
```

## Decision Points

### When to Show Credit Cost?
**Always visible:**
- During customization: "Uses 10 credits (1 generation)"
- Before generation: Confirm button shows "Generate (10 credits)"
- If insufficient: Block action, show "Get X more credits"

### When to Block Generation?
- No credits remaining
- Insufficient credits for requested generation (need 4)

### When to Show Upsell?
- After Try Once: "Subscribe to keep creating"
- Low credits (<8): "Running low - buy more or subscribe"
- Starter user buying top-ups frequently: "Upgrade to Pro for cheaper top-ups"

---

## 8. Onboarding Flow

### Overview
TeamShots implements a comprehensive onboarding experience using the Onborda library to guide new users through the platform. The onboarding flow adapts based on user type, plan tier, and progress state. Tours are triggered automatically based on context conditions and user actions.

### Technical Implementation
- **Library**: Onborda for product tours and tooltips
- **Persistence**: Client-side localStorage tracks tour completion (`onboarding-{tourName}-seen`)
- **Context**: Adapts based on user role, account mode, plan tier, and progress flags
- **Trigger Conditions**: Each tour has specific conditions that must be met before it can start
- **Page-Specific**: Some tours trigger automatically when navigating to specific pages

### Onboarding Tours Reference

#### 1. Welcome Tour (`welcome`)
**Trigger**: `!hasGeneratedPhotos && !isTeamAdmin`  
**Steps**: 2
- `#welcome-section`: Welcome message with personalized greeting
- `#sidebar-personal-styles-nav`: Highlights photo styles customization option

**Purpose**: Tour name: `welcome`. Initial welcome for individual (non-team-admin) users who haven't generated photos yet.

#### 2. Team Admin Welcome Tour (`team-admin-welcome`)
**Trigger**: `!hasGeneratedPhotos && isTeamAdmin && !teamId`  
**Steps**: 2
- `#welcome-section`: Welcome message for team administrators
- `#teamName`: Prompts to add team name

**Purpose**: Tour name: `team-admin-welcome`. Welcome flow for team administrators before team creation.

#### 3. First Generation Tour (`first-generation`)
**Trigger**: `!hasGeneratedPhotos`  
**Steps**: 4
- `#upload-photo`: Upload area explanation
- `#generation-type-selector`: Choose between personal or team generation context
- `#credit-cost-display`: Credit cost information (10 credits per generation)
- `#generate-btn`: Generate button call-to-action

**Purpose**: Tour name: `first-generation`. Guided tour for first photo generation, applicable to all user types.

#### 4. Team Setup Tour (`team-setup`)
**Trigger**: `isTeamAdmin && !teamId`  
**Steps**: 3
- `#team-create-btn`: Create team button
- `#photo-style-setup`: Photo style setup guidance
- `#invite-members`: Invite members guidance

**Purpose**: Tour name: `team-setup`. Guide team admins through initial team setup before team creation.

#### 5. Team Photo Style Setup Tour (`team-photo-style-setup`)
**Trigger**: `isTeamAdmin && teamId && !hasGeneratedPhotos`  
**Steps**: 1
- `#sidebar-team-styles-nav`: Directs to team photo styles page

**Purpose**: Tour name: `team-photo-style-setup`. Redirects team admins to set up team photo styles after team creation.

#### 6. Team Photo Styles Page Tour - Paid Plan (`team-photo-styles-page`)
**Trigger**: `isTeamAdmin && teamId && !hasGeneratedPhotos && !isFreePlan`  
**Page**: `/app/styles/team`  
**Steps**: 2
- `#team-photo-styles-heading`: Explains what team photo styles are
- `#create-team-style-btn`: Guides to create custom styles

**Purpose**: Tour name: `team-photo-styles-page`. Explains team photo styles page for paid plan team admins.

#### 7. Team Photo Styles Page Tour - Free Plan (`team-photo-styles-free`)
**Trigger**: `isTeamAdmin && teamId && !hasGeneratedPhotos && isFreePlan`  
**Page**: `/app/styles/team`  
**Steps**: 9
- `#team-photo-styles-heading`: Explains team photo styles concept
- `[data-testid="free-plan-banner"]`: Free plan limitations and upgrade CTA
- `#style-background`: Background configuration explanation
- `#style-branding`: Branding/logo placement explanation
- `#style-shot-type`: Shot type (3/4) explanation
- `#style-clothing-type`: Clothing type (business casual) explanation
- `#style-clothing-colors`: Clothing colors explanation
- `#style-expression`: Expression (confident) explanation
- `#team-photo-styles-heading`: Final step - ready to generate or invite

**Purpose**: Tour name: `team-photo-styles-free`. Comprehensive walkthrough of free plan team photo styles page, explaining all pre-configured settings.

#### 8. Personal Photo Styles Page Tour - Paid Plan (`personal-photo-styles-page`)
**Trigger**: `isRegularUser && !hasGeneratedPhotos && !isFreePlan`  
**Page**: `/app/styles/personal`  
**Steps**: 2
- `#personal-photo-styles-heading`: Explains what personal photo styles are
- `#create-personal-style-btn`: Guides to create custom styles

**Purpose**: Tour name: `personal-photo-styles-page`. Explains personal photo styles page for paid plan individual users.

#### 9. Personal Photo Styles Page Tour - Free Plan (`personal-photo-styles-free`)
**Trigger**: `isRegularUser && !hasGeneratedPhotos && isFreePlan`  
**Page**: `/app/styles/personal`  
**Steps**: 8
- `#personal-photo-styles-heading`: Explains personal photo styles concept
- `[data-testid="free-plan-banner"]`: Free plan limitations and upgrade CTA
- `#style-background`: Background configuration explanation
- `#style-branding`: Branding/logo placement explanation
- `#style-shot-type`: Shot type (3/4) explanation
- `#style-clothing-type`: Clothing type (business casual) explanation
- `#style-clothing-colors`: Clothing colors customization explanation
- `#primary-generate-btn`: Ready to generate first photo

**Purpose**: Tour name: `personal-photo-styles-free`. Comprehensive walkthrough of free plan personal photo styles page, explaining all pre-configured settings.

#### 10. Photo Style Creation Tour (`photo-style-creation`)
**Trigger**: `((isTeamAdmin && teamId) || isRegularUser) && !isFreePlan`  
**Page**: `/app/styles/team/create` or `/app/styles/personal/create`  
**Steps**: 11
- `#style-name-input`: Name your style
- `#composition-settings-section`: Composition settings overview
- `#background-toggle`: User choice vs predefined toggle explanation
- `#background-settings`: Background customization
- `#branding-settings`: Branding/logo placement options
- `#shotType-settings`: Shot type selection
- `#user-style-settings-section`: User style settings overview
- `#clothing-settings`: Clothing style configuration
- `#clothingColors-settings`: Clothing colors configuration
- `#expression-settings`: Facial expression settings
- `#autosave-indicator`: Automatic saving explanation

**Purpose**: Tour name: `photo-style-creation`. Comprehensive guide through creating a new photo style for paid plan users.

#### 11. Test Generation Tour (`test-generation`)
**Trigger**: `isTeamAdmin && teamId && !hasGeneratedPhotos`  
**Steps**: 1
- `#primary-generate-btn`: Encourages testing the service with first photo generation

**Purpose**: Tour name: `test-generation`. Encourages team admins to test the generation process before inviting team members.

#### 12. Invite Team Tour (`invite-team`)
**Trigger**: `isTeamAdmin && teamId`  
**Page**: `/app/team`  
**Steps**: 4
- `#team-name-header`: Page title with team name context
- `#team-invites-table`: Invites table explanation
- `#team-active-style` or `#team-free-plan-banner`: Active photo style explanation (varies by plan)
- `#invite-team-member-btn`: Invite team members button

**Purpose**: Tour name: `invite-team`. Guide team admins through inviting team members after team and style setup.

#### 13. Generation Detail Tour (`generation-detail`)
**Trigger**: `hasGeneratedPhotos && (isRegularUser || isTeamAdmin)`  
**Page**: `/app/generations/team` or `/app/generations/personal`  
**Steps**: 2
- `[data-onborda="generated-photo"]`: Generated photo explanation
- `[data-onborda="credits-info"]`: Management options (download, regenerate, delete) and credit information

**Purpose**: Tour name: `generation-detail`. Explains how to interact with generated photos after first generation.

### Flow Sequences

#### Individual User Onboarding Flow
```
1. User signs up with "Personal" account type
2. Welcome tour (`welcome`) triggers on dashboard
   - Highlights welcome section
   - Points to photo styles customization
3. User navigates to `/app/styles/personal`
   - If free plan: `personal-photo-styles-free` tour triggers (8 steps)
   - If paid plan: `personal-photo-styles-page` tour triggers (2 steps)
4. If paid plan and user navigates to `/app/styles/personal/create`:
   - `photo-style-creation` tour triggers (11 steps)
5. User navigates to generation page
6. First generation tour (`first-generation`) triggers
   - Guides through upload, style selection, credits, generate
7. After first generation: `hasGeneratedPhotos=true`
   - `generation-detail` tour triggers (2 steps) - explains how to interact with generated photos
8. After generation detail tour: Tours no longer trigger automatically
```

#### Team Admin Onboarding Flow
```
1. User signs up with "Team" account type
2. Team admin welcome tour (`team-admin-welcome`) triggers
   - Welcome message
   - Prompts team name entry
3. User creates team (teamId assigned)
4. User navigates to `/app/styles/team`
   - Photo style explanation tour triggers:
     - If free plan: `team-photo-styles-free` tour (9 steps)
     - If paid plan: `team-photo-styles-page` tour (2 steps)
5. If paid plan and user navigates to `/app/styles/team/create`:
   - `photo-style-creation` tour triggers (11 steps)
6. User navigates to `/app/team`
   - `invite-team` tour triggers (4 steps)
7. Test generation tour (`test-generation`) may trigger
   - Encourages admin to test before inviting
8. After first generation: `hasGeneratedPhotos=true`
   - `generation-detail` tour triggers (2 steps) - explains how to interact with generated photos
9. After generation detail tour: Tours no longer trigger automatically
```

#### Invited Team Member Flow
```
1. Team member receives invite link with token
2. Token validation and consent screen
3. First generation tour (`first-generation`) triggers
   - Same 4-step flow as individual users
4. After generation: `hasGeneratedPhotos=true`
   - `generation-detail` tour triggers (2 steps) - explains how to interact with generated photos
5. After generation detail tour: Tours no longer trigger
```

### Sidebar Indicators
The sidebar displays numbered badges for required actions:
- **"1" on Team**: Team admin needs to create/setup team
- **"1" on Styles**: Pro user hasn't set up photo styles
- **"1" on Invite**: Team admin needs to invite members

### User Experience Principles
- **Progressive**: Tours shown only when relevant conditions are met
- **Skippable**: Users can dismiss tours anytime
- **Persistent**: Progress saved in localStorage across sessions
- **Context-Aware**: Different tours for free vs paid plans, team vs individual
- **Page-Specific**: Some tours only trigger on specific routes
- **Accessible**: Keyboard navigation and screen reader support