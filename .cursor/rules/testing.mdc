---
description: Testing best practices for E2E and integration tests
globs: tests/**/*.ts, **/*.test.ts, **/*.spec.ts
---
# Testing Best Practices

## Test Setup
- Update test configs when code changes affect auth, DB, or API endpoints
- Use real database connections for E2E tests (not extensive mocking)
- Verify test database setup works before writing tests
- Update navigation URLs when routes change

## Test Development
- Read actual source code before writing selectors/assertions
- Inspect DOM structure using debug tests
- Check Prisma schema for correct model names and relationships
- Verify API endpoints exist and match implementation
- Test with real data, not assumptions

## Configuration
- Use E2E auth headers (`x-e2e-user-id`, `x-e2e-user-email`)
- Set `__TEST_DB__ = true` for database isolation
- Only mock CSRF tokens - let other API calls hit real endpoints
- Use absolute URLs (`https://localhost:3000`)
- Handle browser dialogs with Playwright dialog handlers

## Code Investigation
- Search codebase for actual component implementations
- Check Prisma schema for model names and relationships
- Verify API route handlers exist
- Inspect UI components for real selectors and data attributes
- Read existing working tests as reference

## Database Management
- Create real users with proper relationships (User + Person)
- Use beforeAll/afterAll hooks for setup/cleanup
- Verify database operations in tests
- Clean up test data after each run