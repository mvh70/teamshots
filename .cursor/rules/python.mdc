---
description: Python best practices for background workers and image processing
globs: **/*.py, workers/**/*.py, scripts/**/*.py
---

# Python Best Practices

## Code Style
- Black formatting (88 char lines)
- isort for imports
- PEP 8 naming: snake_case (functions), PascalCase (classes), UPPER_CASE (constants)
- Type hints on all function parameters and returns

## Image Processing (rembg)
- Use `u2net_human_seg` model for human subjects
- Validate input before processing
- Handle PIL Image objects properly
- Clean up temporary files
```python
from rembg import remove
from PIL import Image
from pathlib import Path

def remove_background(input_path: Path, output_path: Path) -> bool:
    try:
        with Image.open(input_path) as img:
            output = remove(img, model_name="u2net_human_seg")
            output.save(output_path)
        return True
    except Exception as e:
        logger.error(f"Failed: {e}")
        return False
```

## Worker Integration
- Redis for job queues (Bull/BullMQ from Node.js)
- Return JSON via stdout
- Use proper exit codes (0 = success, 1 = error)
- Log errors to stderr
```python
import json, sys

try:
    job = json.loads(sys.stdin.read())
    result = process_job(job)
    print(json.dumps(result))
    sys.exit(0)
except Exception as e:
    print(json.dumps({"error": str(e)}), file=sys.stderr)
    sys.exit(1)
```

## Error Handling
- Catch specific exceptions (FileNotFoundError, PIL errors)
- Log with context
- Return proper status codes

## Dependencies
Pin versions in requirements.txt:
```
rembg>=2.0.50
Pillow>=9.0.0
numpy>=1.21.0
onnxruntime
```

## Performance
- Process asynchronously
- Monitor memory usage (images can be large)
- Clean up resources
- Use connection pooling for external services