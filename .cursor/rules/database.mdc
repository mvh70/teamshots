---
description: Database best practices for Prisma with local PostgreSQL
globs: prisma/**/*, src/db/**/*, **/*.prisma
---

# Database Best Practices (Prisma + PostgreSQL)

## Prisma Schema
- Use clear model naming (PascalCase)
- Define proper relations and field types
- Implement indexes on frequently queried fields
- Use enums for fixed value sets
- Add constraints (unique, default, optional)
- Configure connection pooling in schema.prisma

## Migrations & Seeding
- Generate migrations for schema changes
- Review migrations before applying
- Use proper seeding for initial/test data
- Version control all migration files
- Test migrations on staging before production

## Query Optimization
- Avoid N+1 queries (use `include` or `select`)
- Use proper filtering and pagination
- Implement cursor-based pagination for large datasets
- Leverage transactions for related operations
- Use aggregations and grouping efficiently
- Batch operations where possible

## PostgreSQL Configuration
- Configure proper connection strings with pooling
- Use environment variables for credentials
- Set appropriate pool size and timeout
- Enable query logging in development
- Use read replicas for scaling (if applicable)

## Security
- Never commit credentials to version control
- Use parameterized queries (Prisma handles this)
- Implement proper authentication/authorization
- Encrypt sensitive data at rest
- Regular backups with tested restore procedures
- Monitor and log database access

## Schema Design
- Normalize to reduce redundancy
- Use appropriate data types (timestamptz, jsonb, etc)
- Define cascade rules for deletions
- Add proper foreign key constraints
- Index foreign keys and frequently filtered columns

## Performance Monitoring
- Track slow queries and optimize
- Monitor connection pool usage
- Review and optimize indexes regularly
- Use EXPLAIN ANALYZE for complex queries
- Set up alerts for connection/performance issues

## Best Practices
- Document schema with comments
- Use TypeScript types generated from Prisma
- Handle errors with proper try-catch
- Keep client instantiation singleton pattern
- Regular database maintenance (VACUUM, ANALYZE)